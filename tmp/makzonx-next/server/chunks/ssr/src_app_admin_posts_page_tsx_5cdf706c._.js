module.exports=[73969,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(20237);a.i(69387);var e=a.i(60574),f=a.i(96221),g=a.i(33441),h=a.i(33508),i=a.i(70106);let j=(0,i.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var k=a.i(87532);let l=(0,i.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),m=(0,i.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var n=a.i(38246),o=a.i(56025),p=a.i(21007),q=a.i(87552);function r(){let{user:a}=(0,o.useAuth)(),[i,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)("pending"),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(new Set),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)("incomplete_details"),[K,L]=(0,c.useState)(""),M=async()=>{t(!0),B(new Set);try{let a=(0,e.query)((0,e.collection)(d.db,"products"),(0,e.where)("status","==",u),(0,e.orderBy)("createdAt","desc")),b=await (0,e.getDocs)(a),c=[];b.forEach(a=>{c.push({id:a.id,...a.data()})}),r(c)}catch(a){console.error("Error fetching posts:",a)}finally{t(!1)}};(0,c.useEffect)(()=>{M()},[u]);let N=async(b,c,f)=>{x(b.id);try{let g={status:c,reviewedBy:a?.uid,reviewedAt:(0,e.serverTimestamp)()};f&&"rejected"===c&&(g.rejectionReason=f),await (0,e.updateDoc)((0,e.doc)(d.db,"products",b.id),g);let h="approved"===c?"notifications.types.post_approved":"notifications.types.post_rejected",i="approved"===c?`Your listing '${b.description_en||b.description}' has been approved and is now live.`:`Your listing '${b.description_en||b.description}' was not approved. Reason: ${f}`,j=b.userId||b.sellerId||"unknown";if("unknown"!==j){await (0,e.addDoc)((0,e.collection)(d.db,"notifications"),{userId:j,type:"approved"===c?"post_approved":"post_rejected",title:h,message:i,read:!1,createdAt:(0,e.serverTimestamp)(),link:"/admin/posts"});let a=b.userEmail||b.contactEmail;a&&await (0,e.addDoc)((0,e.collection)(d.db,"mail"),{to:a,message:{subject:"approved"===c?"Listing Approved - Intaglab":"Listing Needs Attention - Intaglab",html:`
                                <h2>Listing ${"approved"===c?"Approved":"Needs Attention"}</h2>
                                <p>Hello,</p>
                                <p>${i}</p>
                                <br/>
                                <p>Thank you,</p>
                                <p>Intaglab Team</p>
                            `}})}r(a=>a.filter(a=>a.id!==b.id)),B(a=>{let c=new Set(a);return c.delete(b.id),c}),H(null)}catch(a){console.error("Error updating status:",a),alert("Failed to update status")}finally{x(null)}},O=async a=>{if(confirm("Permanently delete this post? This cannot be undone.")){x(a);try{await (0,e.deleteDoc)((0,e.doc)(d.db,"products",a)),r(b=>b.filter(b=>b.id!==a))}catch(a){console.error("Error deleting:",a),alert("Failed to delete post")}finally{x(null)}}},P=async b=>{if(0===A.size)return;let c="approved"===b?"approve":"reject";if(confirm(`${c.charAt(0).toUpperCase()+c.slice(1)} ${A.size} post(s)?`)){D(!0);try{await Promise.all(Array.from(A).map(c=>(0,e.updateDoc)((0,e.doc)(d.db,"products",c),{status:b,reviewedBy:a?.uid,reviewedAt:(0,e.serverTimestamp)()}))),r(a=>a.filter(a=>!A.has(a.id))),B(new Set)}catch(a){console.error("Bulk action error:",a),alert("Some updates failed")}finally{D(!1)}}},Q=i.filter(a=>{if(!y)return!0;let b=y.toLowerCase();return(a.description_en||a.description||"").toLowerCase().includes(b)||(a.category||"").toLowerCase().includes(b)||(a.listingType||"").toLowerCase().includes(b)}),R=a=>a?p.CATEGORIES[a]||a:"—",S=a=>a?p.CITIES[a]||a:"—";return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:q.default.pageHeader,children:[(0,b.jsx)("h1",{className:q.default.pageTitle,children:"Post Moderation"}),(0,b.jsx)("p",{className:q.default.pageSubtitle,children:"Review, approve, and manage product listings"})]}),(0,b.jsxs)("div",{className:q.default.toolbar,children:[(0,b.jsx)("div",{className:q.default.filterPills,children:["pending","approved","rejected"].map(a=>(0,b.jsx)("button",{onClick:()=>v(a),className:`${q.default.filterPill} ${u===a?q.default.filterPillActive:""}`,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),(0,b.jsxs)("div",{className:q.default.searchBox,children:[(0,b.jsx)(k.Search,{size:16,className:q.default.searchIcon}),(0,b.jsx)("input",{type:"text",placeholder:"Search posts...",value:y,onChange:a=>z(a.target.value),className:q.default.searchInput})]}),"pending"===u&&A.size>0&&(0,b.jsx)("div",{className:q.default.toolbarActions,children:(0,b.jsxs)("button",{onClick:()=>P("approved"),disabled:C,className:`${q.default.bulkBtn} ${q.default.bulkBtnApprove}`,children:[(0,b.jsx)(g.Check,{size:14}),"Approve (",A.size,")"]})})]}),"pending"===u&&Q.length>0&&(0,b.jsxs)("div",{style:{marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,b.jsx)("input",{type:"checkbox",checked:A.size===Q.length&&Q.length>0,onChange:()=>{A.size===Q.length?B(new Set):B(new Set(Q.map(a=>a.id)))},style:{accentColor:"#8b5cf6"}}),(0,b.jsxs)("span",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.4)"},children:["Select all (",Q.length,")"]})]}),s?(0,b.jsx)("div",{className:q.default.loaderWrap,children:(0,b.jsx)(f.Loader2,{className:q.default.spinner,size:36,style:{animation:"spin 1s linear infinite"}})}):0===Q.length?(0,b.jsx)("div",{className:q.default.card,children:(0,b.jsx)("div",{className:q.default.emptyState,children:y?`No results for "${y}"`:`No ${u} posts found.`})}):(0,b.jsx)("div",{className:q.default.postsList,children:Q.map(a=>(0,b.jsxs)("div",{className:`${q.default.postCard} ${A.has(a.id)?q.default.postCardSelected:""}`,children:["pending"===u&&(0,b.jsx)("div",{className:q.default.postCheckbox,children:(0,b.jsx)("input",{type:"checkbox",checked:A.has(a.id),onChange:()=>{var b;return b=a.id,void B(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})}})}),(0,b.jsx)("div",{className:q.default.postImageWrap,onClick:()=>F(a),children:(0,b.jsx)("img",{src:a.images?.length>0?a.images[0]:p.CATEGORY_IMAGES[a.category||"other"]||p.CATEGORY_IMAGES.other,alt:"",className:q.default.postImage})}),(0,b.jsxs)("div",{className:q.default.postBody,children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:q.default.postTopRow,children:[(0,b.jsx)("span",{className:q.default.postBadge,children:a.listingType}),(0,b.jsx)("span",{className:q.default.postDate,children:a.createdAt?.seconds?new Date(1e3*a.createdAt.seconds).toLocaleDateString():"Just now"})]}),(0,b.jsx)("h3",{className:q.default.postTitle,children:a.description_en||a.description}),(0,b.jsxs)("p",{className:q.default.postMeta,children:[R(a.category)," · ",a.price," ",a.currency," · ",S(a.location)]})]}),(0,b.jsxs)("div",{className:q.default.postActions,children:[(0,b.jsxs)("button",{className:`${q.default.postActionBtn} ${q.default.btnPreview}`,onClick:()=>F(a),children:[(0,b.jsx)(m,{size:14}),"Details"]}),(0,b.jsxs)(n.default,{href:`/products/${a.id}`,target:"_blank",className:`${q.default.postActionBtn} ${q.default.btnPreview}`,children:[(0,b.jsx)(j,{size:14}),"Preview"]}),(0,b.jsx)("div",{className:q.default.postActionSpacer}),"pending"===u&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:()=>H(a),disabled:w===a.id,className:`${q.default.postActionBtn} ${q.default.btnReject}`,children:[(0,b.jsx)(h.X,{size:14}),"Reject"]}),(0,b.jsxs)("button",{onClick:()=>N(a,"approved"),disabled:w===a.id,className:`${q.default.postActionBtn} ${q.default.btnApprove}`,children:[w===a.id?(0,b.jsx)(f.Loader2,{size:14,style:{animation:"spin 1s linear infinite"}}):(0,b.jsx)(g.Check,{size:14}),"Approve"]})]}),"rejected"===u&&(0,b.jsx)("button",{onClick:()=>N(a,"pending"),disabled:w===a.id,className:`${q.default.postActionBtn} ${q.default.btnReevaluate}`,children:"Re-evaluate"}),"approved"===u&&(0,b.jsx)("button",{onClick:()=>N(a,"pending"),disabled:w===a.id,className:`${q.default.postActionBtn} ${q.default.btnReevaluate}`,children:"Suspend"}),(0,b.jsx)("button",{onClick:()=>O(a.id),disabled:w===a.id,className:`${q.default.postActionBtn} ${q.default.btnDelete}`,title:"Delete permanently",children:(0,b.jsx)(l,{size:14})})]})]})]},a.id))}),E&&(0,b.jsx)("div",{className:q.default.modalOverlay,onClick:()=>F(null),children:(0,b.jsxs)("div",{className:q.default.modalContent,onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("button",{className:q.default.modalClose,onClick:()=>F(null),children:(0,b.jsx)(h.X,{size:20})}),E.images?.length>0&&(0,b.jsx)("div",{className:q.default.modalGallery,children:E.images.map((a,c)=>(0,b.jsx)("img",{src:a,alt:"",className:q.default.modalGalleryImage},c))}),(0,b.jsxs)("div",{className:q.default.modalBody,children:[(0,b.jsxs)("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",flexWrap:"wrap"},children:[(0,b.jsx)("span",{className:q.default.postBadge,children:E.listingType}),(0,b.jsx)("span",{className:`${q.default.statusBadge} ${"approved"===E.status?q.default.statusActive:"rejected"===E.status?q.default.statusBanned:""}`,style:"pending"===E.status?{background:"rgba(234,179,8,0.15)",color:"#facc15"}:{},children:E.status})]}),(0,b.jsx)("h2",{className:q.default.modalTitle,children:E.description_en||E.description}),E.description_ar&&(0,b.jsx)("p",{style:{fontSize:"0.85rem",color:"rgba(255,255,255,0.4)",direction:"rtl",marginBottom:"0.5rem"},children:E.description_ar}),(0,b.jsxs)("div",{className:q.default.modalDetailGrid,children:[(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Category"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:R(E.category)})]}),(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Price"}),(0,b.jsxs)("span",{className:q.default.modalDetailValue,children:[E.price," ",E.currency]})]}),(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Location"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:S(E.location)})]}),(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Condition"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:E.condition||"—"})]}),E.quantity&&(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Quantity"}),(0,b.jsxs)("span",{className:q.default.modalDetailValue,children:[E.quantity," ",E.unitMetric]})]}),E.mfgDate&&(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Mfg Date"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:E.mfgDate})]}),(E.warranty_en||E.warranty)&&(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Warranty"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:E.warranty_en||E.warranty})]}),(E.delivery_en||E.delivery)&&(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Delivery"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:E.delivery_en||E.delivery})]}),(E.terms_en||E.terms)&&(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Terms"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:E.terms_en||E.terms})]}),(0,b.jsxs)("div",{className:q.default.modalDetailItem,children:[(0,b.jsx)("span",{className:q.default.modalDetailLabel,children:"Posted"}),(0,b.jsx)("span",{className:q.default.modalDetailValue,children:E.createdAt?.seconds?new Date(1e3*E.createdAt.seconds).toLocaleString():"Just now"})]})]})]}),"pending"===E.status&&(0,b.jsxs)("div",{className:q.default.modalFooter,children:[(0,b.jsxs)("button",{onClick:()=>{H(E),F(null)},className:`${q.default.postActionBtn} ${q.default.btnReject}`,children:[(0,b.jsx)(h.X,{size:14})," Reject"]}),(0,b.jsxs)("button",{onClick:()=>{N(E,"approved"),F(null)},className:`${q.default.postActionBtn} ${q.default.btnApprove}`,children:[(0,b.jsx)(g.Check,{size:14})," Approve"]})]})]})})]})}a.s(["default",()=>r],73969)}];

//# sourceMappingURL=src_app_admin_posts_page_tsx_5cdf706c._.js.map